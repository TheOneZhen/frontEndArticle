# 内容嵌入

HTML有以下嵌入元素：

- `<iframe>`：将整个HTML页面放置到当前页面中
- `<embed>`：
- `<object>`：
- `<audio>`
- `<canvas>`
- `<img>`
- `<math>`
- `<svg>`
- `<video>`

当你使用过上述标签，代表你已经进入微前端了，既然这样，也没必要为微前端做定义，直接进入下一节。

# 嵌入带来的安全问题

- iframe注入：
  
    跨站脚本（XSS，Cross Site Scripting）攻击的一种，如果你的网站支持用户修改网站HTML，可能会被有心之人注入不怀好意的`<iframe>`。或者你通过GET参数获取一段代码并执行，像下面这样，当然下面这个链接看起来就不正常：
    
    ```js
    // url: http://site.com/?code=%3Ciframe%20src='hacker'%3E
    // 然后你解析这个链接获取code参数的文本，将这个脚本写入文档
    code = decodeURL(url) // http://site.com/?code=<iframe src='hacker'>
    document.write(code)
    ```
    
    然后你的文档中莫名多出一个广告，如果是更恶意的代码，可能会获取网站**cookie**然后一系列操作，带来严重后果。

- 点击劫持
- XFS


### HTTPS

HTTPS是HTTP的加密版本，作用：

- 尽可能避免远程内容在传输过程中被修改
- 防止嵌入式内容访问

### sandbox

同时添加**allow-scripts**和**allow-same-origin**，嵌入式内容可以绕过阻止站点执行脚本的同源策略（SOP，Same Origin Policy），并使用JS完全关闭**sandbox**。

### 配置CSP指令

内容安全策略（CSP，Content Security Policy），提供一些HTTP头，

X-Frame-Options：服务器设置不允许被嵌入到其他页面

# iframe

当iframe与parent同源时，

## 通信

### HTMLIFrameElement

`HTMLIFrameElement`是iframe元素的接口，提供了一些特殊属性和方法，比如：

- `HTMLIFrameElement.contentDocument`(只读)：如果子iframe和parent同源，返回子iframe的`document`对象，否则返回`null`；
- `HTMLIFrameElement.contentWindow`(只读)：返回子iframe的window对象

可以借助上述的属性或方法，将安全的信息抛给parent。

contentDocument存在一个陷阱，iframe加载时会立即生成一个document对象，但是这个document对象不是`contentDocument`：
```html
...
<iframe src='' id='iframe' />
...
<script>
  let document = iframe.contentDocument
  iframe.onload = function () {
    console.log('is same: ', document === iframe.contentDocument) // is same: false
  }
</script>

```

### postMessage


# 微前端

3. 大前端时代组件复用
4. 防止嵌入式内容访问你的父文档中的内容，反之亦然

## 框架介绍
- QianKun
- microApp
  - 为什么vite项目作为子应用，在microApp搭建过程中，沙箱被取消
- signal spa
- 无界


# 引用

1. https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Multimedia_and_embedding/Other_embedding_technologies